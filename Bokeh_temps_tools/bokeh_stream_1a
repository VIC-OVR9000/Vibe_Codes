from bokeh.plotting import figure, curdoc
from bokeh.models import ColumnDataSource
from math import sin
import numpy as np
import panel as pn # Import panel

pn.extension() # Initialize Panel

# 1. Setup the data source (The 'Brain' of the stream)
source = ColumnDataSource(data=dict(x=[0], y=[0]))

# 2. Create the figure
p = figure(height=400, width=800, title="Real-Time Performance Stream")
p.line(x='x', y='y', source=source, line_width=2, color="navy")

# 3. Define the update logic
step = 0
def update():
    global step
    step += 0.1
    # Only the NEW data point is sent over the wire, not the whole plot
    new_data = dict(x=[step], y=[sin(step)])

    # 'rollover' drops old points to keep browser memory lean
    source.stream(new_data, rollover=200)

# 4. Schedule the update (e.g., every 50 milliseconds)
curdoc().add_periodic_callback(update, 50)

# Create a Panel layout
panel_layout = pn.Column(
    "# Real-Time Performance Dashboard", # Add a title using Markdown
    p # Add your Bokeh figure
)

# Serve the Panel layout
panel_layout.servable()
